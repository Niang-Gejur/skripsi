import pandas as pd
import joblib
from sklearn.pipeline import Pipeline
from sklearn.feature_extraction.text import TfidfVectorizer
from sklearn.naive_bayes import MultinomialNB

# ===============================================================
# 1️⃣ Load Dataset
# ===============================================================
df = pd.read_excel("mobilelegends_labelled.xlsx")
df.columns = df.columns.str.strip()
df = df.dropna(subset=["stemmed_text", "sentiment_label"])

X = df["stemmed_text"].astype(str)
y = df["sentiment_label"]

# ===============================================================
# 2️⃣ Pipeline TF-IDF + Naïve Bayes (FINAL)
# ===============================================================
nb_pipeline = Pipeline([
    ("tfidf", TfidfVectorizer(
        lowercase=True,
        ngram_range=(1, 2),
        min_df=3,
        max_df=0.85,
        sublinear_tf=True
    )),
    ("classifier", MultinomialNB(alpha=0.1))
])

# ===============================================================
# 3️⃣ Train Model (FULL DATA)
# ===============================================================
nb_pipeline.fit(X, y)

# ===============================================================
# 4️⃣ Simpan Model
# ===============================================================
joblib.dump(nb_pipeline, "model_nb.pkl")

print("✅ model_nb.pkl versi FINAL berhasil dibuat")
